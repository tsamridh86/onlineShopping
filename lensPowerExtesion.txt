<!-- This patch is to add the power of the glasses if needed -- >

<!-- Changes that are needed here will be on the order table, ie, config.php , then 
	it would require some changes on orderPage.php & orderComplete.php.
	No other pages would be changed. The adminPage & the sellerPage display will have to be readjusted for display purposes only,
	there will be no other significant changes otherwise.
	Of course, don't forget to drop the database after adding this patch, you are going to modify a table,
	so, database has to be dropped.
	 -->


<!--Changes on config.php -->

<?php
//to be changed in line no 47
//the table of orders are extended to accomodate the power, however the table of items are not extended, because power of the lens are determined by the order given & not the item, hence it is better to be placed in orders table
$que = "create table if not exists orders ( orderId int primary key auto_increment, custId int references users(userId) , itemId int references items(itemId) on delete set null, quantity int , leftPower int , rightPower int);";
?>


<!--Changes on orderPage.php -->
on line no 69, there is an if condition:
if ($row['type']=='S')
	echo "<p> Quantity : <input type = number name = 'quantity' > </p>";
else
	echo "<p> Bid a price for this item : <input type = 'number' name = 'quantity'></p>";
change this into:
if ($row['type']=='S')
	{
	echo "<p> Quantity : <input type = number name = 'quantity' > </p>";
	if($cat2 == 'eyeglasses')
		{
		echo "<p> Power on Left: <input type = number name = 'leftPower' > </p>";
		echo "<p> Power on Right: <input type = number name = 'rightPower' > </p>";
		}
	}
else
	echo "<p> Bid a price for this item : <input type = 'number' name = 'quantity'></p>";





<!--Changes to be made in orderComplete.php -->
<?php

//mod1
//the if condition is not extended because, if customer leaves it empty we assume it to be zero,
//so, add these  extra line anywhere between line no.8 & 15
if(empty($_POST['leftPower'])) $leftPower = 0;
else $leftPower = $_POST['leftPower'];
if(empty($_POST['rightPower'])) $rightPower = 0;
else $rightPower = $_POST['rightPower'];


//mod2
//on line no 16 replace the older insert query with
$order = "insert into orders (custId,itemId,quantity,leftPower,rightPower) values (".$_SESSION['userId'].",".$_POST['itemId'].",".$_POST['quantity'].",".$leftPower.",".$rightPower.");";


//mod3(optional)
//the table on line 22 maybe modified
//this table can be extended to display the power of the lenses that has been ordered
echo "<table>
				<th> Order Review : </th>
					<tr>
						<td> Item Name : </td>
						<td>".$itemData['itemName']."</td>
					</tr>
					<tr>
						<td> Quantity : </td>
						<td>".$_POST['quantity']."</td>
					</tr>
					<tr>
						<td> Power on Left: </td>
						<td>".$_leftPower."</td>
					</tr>
					<tr>
						<td> Power on Right : </td>
						<td>".$rightPower."</td>
					</tr>
					<tr>
						<td> Price : </td>
						<td>".$itemData['price']."</td>
					</tr>
					<tr>
						<td> Grand total : </td>
						<td>".($itemData['price']*$_POST['quantity'])."</td>

					</tr>	
				</table>
				";
?>

<!--Changes on adminPage & sellerPage, (these are just simple display changes, maybe done my trail & error method) -->
on the admin page, there is no need to change the queries as we have used select * from orders, this brings in all the rows hence 
there is no need to change in queries, just slightly adjust the table & the div display at line no 203 add :
	<td>Power on Left</td>
	<td>Power on Right</td>
& then in line no 218 add :
	<td>".$row['leftPower']."</td>
	<td>".$row['rightPower']."</td>
the resizing of the table / the div maybe nessecary depending upon the screen size, so that's trail & error method only.

for the changes in the sellerPage:
change the query on line no 180:
from this :
		$que = "select userName, itemName , quantity, price from (items inner join orders on items.itemId = orders.itemId) inner join users on orders.custId = users.userId where sellerId = ".$_SESSION['userId']." and type = 'S' and status = 'Y';";
to : (new query)  (i have just retireved left power & right power extra, nothing more fancy here)
		$que = "select userName, itemName , quantity, price,leftPower, rightPower from (items inner join orders on items.itemId = orders.itemId) inner join users on orders.custId = users.userId where sellerId = ".$_SESSION['userId']." and type = 'S' and status = 'Y';";

then , change the display on the table, on line 187 add : 
	<td> Power on Left</td>
	<td> Power on Right</td>

& on line no 198 : add : 
	<td>".$row['leftPower']."</td>
	<td>".$row['rightPower']."</td>
even this div may require slight touch up by using trail & error method.